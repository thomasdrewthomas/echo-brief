(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[33],{5965:function(e,t,r){Promise.resolve().then(r.bind(r,8685))},8685:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return K}});var a=r(7437),o=r(2265),n=r(2869),s=r(6937),i=r(9877),c=r(9116);let l=(0,o.createContext)(void 0);function d(e){let{children:t}=e,[r,n]=(0,o.useState)([]),[s,i]=(0,o.useState)([]),[d,u]=(0,o.useState)(null),[g,h]=(0,o.useState)(null),[m,y]=(0,o.useState)(!1),[p,f]=(0,o.useState)(null),x=(0,o.useCallback)(async()=>{y(!0),f(null);try{let e=await (0,c.pE)();if(n(e),d){let e=await (0,c.hv)(d.category_id);i(e)}else{let e=await (0,c.hv)();i(e)}}catch(e){f(e instanceof Error?e.message:"An error occurred while fetching data"),console.error("Error fetching data:",e)}finally{y(!1)}},[d]);(0,o.useEffect)(()=>{x()},[x]);let v=(0,o.useCallback)(async e=>{y(!0),f(null);try{await (0,c.k4)(e),await x()}catch(e){throw f(e instanceof Error?e.message:"An error occurred while creating category"),console.error("Error creating category:",e),e}finally{y(!1)}},[x]),j=(0,o.useCallback)(async(e,t,r)=>{y(!0),f(null);try{await (0,c.Wc)(e,t,r),await x()}catch(e){throw f(e instanceof Error?e.message:"An error occurred while creating subcategory"),console.error("Error creating subcategory:",e),e}finally{y(!1)}},[x]),b=(0,o.useCallback)(async(e,t)=>{y(!0),f(null);try{await (0,c.yr)(e,t),await x()}catch(e){throw f(e instanceof Error?e.message:"An error occurred while updating category"),console.error("Error updating category:",e),e}finally{y(!1)}},[x]),w=(0,o.useCallback)(async(e,t,r)=>{y(!0),f(null);try{await (0,c.A4)(e,t,r),await x()}catch(e){throw f(e instanceof Error?e.message:"An error occurred while updating subcategory"),console.error("Error updating subcategory:",e),e}finally{y(!1)}},[x]),N=(0,o.useCallback)(async e=>{y(!0),f(null);try{await (0,c.uu)(e),(null==d?void 0:d.category_id)===e&&u(null),await x()}catch(e){throw f(e instanceof Error?e.message:"An error occurred while deleting category"),console.error("Error deleting category:",e),e}finally{y(!1)}},[x,d]),C=(0,o.useCallback)(async e=>{y(!0),f(null);try{await (0,c.nv)(e),(null==g?void 0:g.id)===e&&h(null),await x()}catch(e){throw f(e instanceof Error?e.message:"An error occurred while deleting subcategory"),console.error("Error deleting subcategory:",e),e}finally{y(!1)}},[x,g]);return(0,a.jsx)(l.Provider,{value:{categories:r,subcategories:s,selectedCategory:d,selectedSubcategory:g,loading:m,error:p,refreshData:x,setSelectedCategory:u,setSelectedSubcategory:h,addCategory:v,addSubcategory:j,editCategory:b,editSubcategory:w,removeCategory:N,removeSubcategory:C},children:t})}function u(){let e=(0,o.useContext)(l);if(void 0===e)throw Error("usePromptManagement must be used within a PromptManagementProvider");return e}var g=r(6110),h=r(5186),m=r(6815),y=r(7992);function p(){let{addCategory:e,loading:t}=u(),[r,c]=(0,o.useState)(!1),[l,d]=(0,o.useState)(""),{toast:p}=(0,y.p)(),f=async()=>{if(!l.trim()){p({title:"Error",description:"Category name cannot be empty",variant:"destructive"});return}try{await e(l),p({title:"Success",description:"Category created successfully"}),d(""),c(!1)}catch(e){p({title:"Error",description:e instanceof Error?e.message:"Failed to create category",variant:"destructive"})}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold tracking-tight",children:"Prompt Management"}),(0,a.jsxs)(i.aG,{children:[(0,a.jsx)(i.gN,{children:(0,a.jsx)(i.At,{href:"/",children:"Home"})}),(0,a.jsx)(i.gN,{children:(0,a.jsx)(i.AG,{children:"Prompt Management"})})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Manage categories, subcategories, and prompts for your AI system."})]}),(0,a.jsxs)(n.z,{onClick:()=>c(!0),children:[(0,a.jsx)(s.Z,{className:"mr-2 h-4 w-4"}),"Add Category"]})]}),(0,a.jsx)(g.Vq,{open:r,onOpenChange:c,children:(0,a.jsxs)(g.cZ,{children:[(0,a.jsx)(g.fK,{children:(0,a.jsx)(g.$N,{children:"Create New Category"})}),(0,a.jsx)("div",{className:"grid gap-4 py-4",children:(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(m._,{htmlFor:"name",children:"Category Name"}),(0,a.jsx)(h.I,{id:"name",value:l,onChange:e=>d(e.target.value),placeholder:"Enter category name"})]},"category-name-field")}),(0,a.jsxs)(g.cN,{children:[(0,a.jsx)(n.z,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),(0,a.jsx)(n.z,{onClick:f,disabled:t,children:t?"Creating...":"Create Category"})]})]})})]})}var f=r(6070),x=r(3643),v=r(4508);let j=o.forwardRef((e,t)=>{let{className:r,children:o,...n}=e;return(0,a.jsxs)(x.fC,{ref:t,className:(0,v.cn)("relative overflow-hidden",r),...n,children:[(0,a.jsx)(x.l_,{className:"h-full w-full rounded-[inherit]",children:o}),(0,a.jsx)(b,{}),(0,a.jsx)(x.Ns,{})]})});j.displayName=x.fC.displayName;let b=o.forwardRef((e,t)=>{let{className:r,orientation:o="vertical",...n}=e;return(0,a.jsx)(x.gb,{ref:t,orientation:o,className:(0,v.cn)("flex touch-none select-none transition-colors","vertical"===o&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===o&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...n,children:(0,a.jsx)(x.q4,{className:"relative flex-1 rounded-full bg-border"})})});b.displayName=x.gb.displayName;var w=r(6512),N=r(1817),C=r(875),E=r(407),k=r(4924),S=r(5868),P=r(8930),T=r(9658),I=r(9397),_=r(6865);let A=(0,r(535).j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),z=o.forwardRef((e,t)=>{let{className:r,variant:o,...n}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,v.cn)(A({variant:o}),r),...n})});z.displayName="Alert";let D=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("h5",{ref:t,className:(0,v.cn)("mb-1 font-medium leading-none tracking-tight",r),...o})});D.displayName="AlertTitle";let O=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,v.cn)("text-sm [&_p]:leading-relaxed",r),...o})});O.displayName="AlertDescription";var Z=r(2339),F=r(166);r(8666),r(2770);let U=(0,F.default)(()=>Promise.all([r.e(798),r.e(524),r.e(146),r.e(370),r.e(768)]).then(r.bind(r,3768)).then(e=>e.default),{loadableGenerated:{webpack:()=>[null]},ssr:!1}),B=(0,F.default)(()=>Promise.all([r.e(798),r.e(146),r.e(370)]).then(r.bind(r,8370)).then(e=>e.default),{loadableGenerated:{webpack:()=>[null]},ssr:!1});function R(e){let{initialPrompts:t={},onSave:r,onCancel:s,hideActionButtons:i=!1}=e,[c,l]=(0,o.useState)([]),[d,u]=(0,o.useState)("edit");(0,o.useRef)(!1);let g=(0,o.useRef)(()=>{});(0,o.useEffect)(()=>{console.log("Initial setup of prompts from initialPrompts:",t);let e=Object.entries(t).map(e=>{let[t,r]=e;return{key:t,value:r}});0===e.length&&e.push({key:"",value:""}),console.log("Setting prompts to:",e),l(e)},[t]);let y=e=>{console.log("Removing prompt at index ".concat(e)),l(t=>{let r=[...t];return r.splice(e,1),r.length>0?r:[{key:"",value:""}]})},p=(e,t)=>{console.log("Updating prompt ".concat(e," key to: ").concat(t)),l(a=>{let o=[...a];return o[e]={...o[e],key:t},r(Object.fromEntries(o.filter(e=>e.key.trim()).map(e=>[e.key.trim(),e.value.trim()]))),o})},f=(e,t)=>{console.log("Updating prompt ".concat(e," value, length: ").concat((null==t?void 0:t.length)||0)),l(a=>{let o=[...a];return o[e]={...o[e],value:t||""},r(Object.fromEntries(o.filter(e=>e.key.trim()).map(e=>[e.key.trim(),e.value.trim()]))),o})},x=()=>{let e={},t=!1;c.forEach(r=>{r.key.trim()&&(t=!0,e[r.key.trim()]=r.value.trim())}),t||console.warn("No valid prompts to save (all empty keys)"),console.log("Saving prompts:",e),r(e)};return(0,o.useEffect)(()=>{g.current=x},[c]),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(Z.mQ,{value:d,onValueChange:u,children:[(0,a.jsxs)(Z.dr,{children:[(0,a.jsx)(Z.SP,{value:"edit",children:"Edit"}),(0,a.jsx)(Z.SP,{value:"preview",children:"Preview"})]}),(0,a.jsxs)(Z.nU,{value:"edit",className:"space-y-4",children:[c.map((e,t)=>(0,a.jsxs)("div",{className:"space-y-4 p-4 border rounded-md",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium",children:["Prompt ",t+1]}),(0,a.jsx)(n.z,{variant:"ghost",size:"sm",onClick:()=>y(t),disabled:1===c.length,children:"Remove"})]},"prompt-header-".concat(t)),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"prompt-key-".concat(t),children:"Prompt Key"}),(0,a.jsx)(h.I,{id:"prompt-key-".concat(t),value:e.key,onChange:e=>{console.log("Key input changed:",e.target.value),p(t,e.target.value)},placeholder:"Enter prompt key (e.g., 'greeting', 'introduction')"})]},"prompt-key-field-".concat(t)),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"prompt-value-".concat(t),children:"Prompt Content (Markdown)"}),(0,a.jsx)(U,{value:e.value,onChange:e=>{console.log("Editor content changed:",null==e?void 0:e.substring(0,20)),f(t,e||"")},preview:"edit",height:200})]},"prompt-content-".concat(t))]},"prompt-".concat(t))),(0,a.jsx)(n.z,{type:"button",variant:"outline",onClick:()=>{console.log("Adding new prompt"),l(e=>[...e,{key:"",value:""}])},className:"w-full",disabled:c.some(e=>!e.key.trim()||!e.value.trim()),children:"Add Prompt"})]}),(0,a.jsx)(Z.nU,{value:"preview",className:"space-y-4",children:c.map((e,t)=>(0,a.jsxs)("div",{className:"space-y-4 p-4 border rounded-md",children:[(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)("h3",{className:"text-lg font-medium",children:e.key||"Prompt ".concat(t+1)})},"preview-header-".concat(t)),(0,a.jsx)("div",{className:"p-4 border rounded-md bg-background",children:(0,a.jsx)(B,{source:e.value})},"preview-content-".concat(t))]},"preview-prompt-".concat(t)))})]}),!i&&(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[s&&(0,a.jsx)(n.z,{variant:"outline",onClick:s,children:"Cancel"}),(0,a.jsx)(n.z,{onClick:()=>{console.log("Save button clicked, current prompts:",c),x()},children:"Save Prompts"})]},"action-buttons")]})}var G=r(3647);function H(e){let{categories:t,selectedCategoryId:r,onSubmit:s,onCancel:i}=e,[c,l]=(0,o.useState)(""),[d,u]=(0,o.useState)(r||""),[g,p]=(0,o.useState)({}),[f,x]=(0,o.useState)(!1),{toast:v}=(0,y.p)(),[j,b]=(0,o.useState)({});(0,o.useEffect)(()=>{r&&(console.log("SubcategoryForm received selectedCategoryId:",r),u(r))},[r]);let w=async e=>{if(e.preventDefault(),console.log("Submitting subcategory with name:",c),console.log("Using category ID:",d),console.log("Final prompts to submit:",j),!c.trim()){v({title:"Error",description:"Subcategory name cannot be empty",variant:"destructive"});return}if(!d){v({title:"Error",description:"Please select a category",variant:"destructive"});return}let t=Object.entries(j).filter(e=>{let[t]=e;return t.trim()});if(0===t.length){v({title:"Error",description:"Please add at least one prompt with a key",variant:"destructive"});return}x(!0);try{let e=Object.fromEntries(t.map(e=>{let[t,r]=e;return[t.trim(),r.trim()]}));console.log("Submitting with formatted prompts:",e),await s(c,d,e),l(""),b({}),p({})}catch(e){console.error("Error submitting subcategory:",e),v({title:"Error",description:e instanceof Error?e.message:"Failed to create subcategory",variant:"destructive"})}finally{x(!1)}};return(0,a.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"name",children:"Subcategory Name"}),(0,a.jsx)(h.I,{id:"name",value:c,onChange:e=>l(e.target.value),placeholder:"Enter subcategory name",required:!0})]},"subcategory-name"),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"category",children:"Category"}),(0,a.jsxs)(G.Ph,{value:d,onValueChange:u,disabled:!!r,required:!0,children:[(0,a.jsx)(G.i4,{children:(0,a.jsx)(G.ki,{placeholder:"Select a category"})}),(0,a.jsx)(G.Bw,{children:t.map(e=>(0,a.jsx)(G.Ql,{value:e.category_id||e.id||"",children:e.name},e.category_id||e.id||""))})]})]},"category-select"),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m._,{children:"Prompts"}),(0,a.jsx)(R,{initialPrompts:g,onSave:e=>{console.log("Received prompts update:",e),b(e),p(e)},hideActionButtons:!0})]},"prompts-editor"),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(n.z,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),(0,a.jsx)(n.z,{type:"submit",disabled:f||0===Object.keys(j).length,children:f?"Creating...":"Create Subcategory"})]},"action-buttons")]})}let V=(0,F.default)(()=>Promise.all([r.e(798),r.e(146),r.e(370)]).then(r.bind(r,8370)).then(e=>e.default),{loadableGenerated:{webpack:()=>[null]},ssr:!1});function q(){let{categories:e,subcategories:t,selectedCategory:r,selectedSubcategory:s,loading:i,error:c,setSelectedCategory:l,setSelectedSubcategory:d,addSubcategory:p,editCategory:x,editSubcategory:v,removeCategory:b,removeSubcategory:A,refreshData:Z}=u(),[F,U]=(0,o.useState)([]),[B,G]=(0,o.useState)(!1),[q,K]=(0,o.useState)(!1),[$,J]=(0,o.useState)(!1),[M,Y]=(0,o.useState)(""),[Q,L]=(0,o.useState)(""),[W,X]=(0,o.useState)({}),{toast:ee}=(0,y.p)(),[et,er]=(0,o.useState)(!1),[ea,eo]=(0,o.useState)(!1),[en,es]=(0,o.useState)(null),[ei,ec]=(0,o.useState)(null),el=e=>{console.log("Toggling category with ID:",e),U(t=>t.includes(e)?(console.log("Removing category from expanded list"),t.filter(t=>t!==e)):(console.log("Adding category to expanded list"),[...t,e]))},ed=e=>{l(e),d(null);let t=e.category_id||e.id||"";F.includes(t)||el(t)},eu=e=>{d(e)},eg=async(e,t,r)=>{if(console.log("Adding subcategory with name:",e),console.log("Category ID for new subcategory:",t),console.log("Prompts:",r),!t){console.error("Category ID is undefined"),ee({title:"Error",description:"Cannot add subcategory: missing category ID",variant:"destructive"});return}try{await p(e,t,r),await Z(),ee({title:"Success",description:"Subcategory added successfully"}),G(!1)}catch(e){console.error("Error adding subcategory:",e),ee({title:"Error",description:e instanceof Error?e.message:"Failed to create subcategory",variant:"destructive"})}},eh=async()=>{if(console.log("handleEditCategory called, isEditCategoryOpen:",q),console.log("Current selectedCategory:",r),console.log("Current editCategoryName:",M),!r){console.error("No category selected for editing"),ee({title:"Error",description:"No category selected for editing",variant:"destructive"});return}try{let e=r.category_id||r.id;if(console.log("Editing category with ID:",e),console.log("New name:",M),!e)throw Error("Category ID is undefined");console.log("About to call editCategory with:",{categoryId:e,name:M}),await x(e,M),console.log("Category updated successfully"),l({...r,name:M}),ee({title:"Success",description:"Category updated successfully"}),K(!1),console.log("Edit dialog closed after successful update")}catch(e){console.error("Edit category error:",e),ee({title:"Error",description:e instanceof Error?e.message:"Failed to update category",variant:"destructive"})}},em=async()=>{if(!s){console.error("No subcategory selected for editing"),ee({title:"Error",description:"No subcategory selected for editing",variant:"destructive"});return}try{let e=s.id;if(!e)throw Error("Invalid subcategory ID");console.log("Updating subcategory:",{id:e,name:Q,prompts:W}),await v(e,Q,W),await Z(),ee({title:"Success",description:"Subcategory updated successfully"}),J(!1)}catch(e){console.error("Error updating subcategory:",e),ee({title:"Error",description:e instanceof Error?e.message:"Failed to update subcategory",variant:"destructive"})}},ey=async()=>{if(en)try{let e=en.category_id||en.id||"";await b(e),ee({title:"Success",description:"Category deleted successfully"}),er(!1),es(null)}catch(e){ee({title:"Error",description:e instanceof Error?e.message:"Failed to delete category",variant:"destructive"})}},ep=async()=>{if(!ei||!ei.id){console.error("Invalid subcategory or missing subcategory ID:",ei),ee({title:"Error",description:"Cannot delete subcategory: Invalid subcategory data",variant:"destructive"});return}try{console.log("Attempting to delete subcategory:",ei),await A(ei.id),await Z(),(null==s?void 0:s.id)===ei.id&&d(null),ee({title:"Success",description:"Subcategory deleted successfully"}),eo(!1),ec(null)}catch(t){let e=t instanceof Error?t.message:"Failed to delete subcategory";console.error("Error deleting subcategory:",t),e.includes("404")?(ee({title:"Error",description:"Subcategory not found. It may have been already deleted.",variant:"destructive"}),eo(!1),ec(null),(null==s?void 0:s.id)===ei.id&&d(null)):e.includes("401")?ee({title:"Authentication Error",description:"Your session has expired. Please log in again.",variant:"destructive"}):ee({title:"Error",description:e,variant:"destructive"})}},ef=e=>{console.log("openEditCategory called with:",e);let t=(null==e?void 0:e.category_id)||(null==e?void 0:e.id);if(!e||!t){console.error("Invalid category data:",e),ee({title:"Error",description:"Could not edit category: missing or invalid data",variant:"destructive"});return}try{let r={...e,category_id:t};l(r),Y(e.name),console.log("Category ID before opening dialog:",t),console.log("Category name before opening dialog:",e.name),setTimeout(()=>{console.log("Opening edit dialog now"),K(!0)},10)}catch(e){console.error("Error in openEditCategory:",e),ee({title:"Error",description:"Something went wrong while trying to edit the category",variant:"destructive"})}},ex=e=>{if(console.log("Opening edit dialog for subcategory:",e),!e||!e.id){console.error("Invalid subcategory data:",e),ee({title:"Error",description:"Cannot edit subcategory: Invalid data",variant:"destructive"});return}d(e),L(e.name),X(e.prompts),J(!0)};return(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-6",children:[(0,a.jsx)(f.Zb,{className:"col-span-3",children:(0,a.jsxs)(f.aY,{className:"p-4",children:[i&&(0,a.jsx)("div",{className:"flex justify-center items-center py-4",children:(0,a.jsx)(N.Z,{className:"h-6 w-6 animate-spin"})}),c&&(0,a.jsxs)(z,{variant:"destructive",className:"mb-4",children:[(0,a.jsx)(D,{children:"Error"}),(0,a.jsx)(O,{children:c})]}),(0,a.jsx)(j,{className:"h-[calc(100vh-200px)]",children:e.map(e=>(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(n.z,{variant:"ghost",className:"w-full justify-start p-2",onClick:()=>ed(e),children:[F.includes(e.category_id||e.id||"")?(0,a.jsx)(C.Z,{className:"mr-2 h-4 w-4"}):(0,a.jsx)(E.Z,{className:"mr-2 h-4 w-4"}),(0,a.jsx)(k.Z,{className:"mr-2 h-4 w-4"}),e.name]}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(n.z,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),ef(e)},children:(0,a.jsx)(S.Z,{className:"h-4 w-4"})}),(0,a.jsx)(n.z,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),es(e),er(!0)},children:(0,a.jsx)(P.Z,{className:"h-4 w-4"})})]})]}),F.includes(e.category_id||e.id||"")&&(0,a.jsxs)("div",{className:"ml-6 mt-2",children:[t.filter(t=>t.category_id===(e.category_id||e.id||"")).map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(n.z,{variant:(null==s?void 0:s.id)===e.id?"secondary":"ghost",className:"w-full justify-start p-2",onClick:()=>eu(e),children:[(0,a.jsx)(T.Z,{className:"mr-2 h-4 w-4"}),e.name]}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(n.z,{variant:"ghost",size:"icon",onClick:()=>ex(e),children:(0,a.jsx)(S.Z,{className:"h-4 w-4"})}),(0,a.jsx)(n.z,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),ec(e),eo(!0)},children:(0,a.jsx)(P.Z,{className:"h-4 w-4"})})]})]},e.id)),(0,a.jsxs)(n.z,{variant:"ghost",className:"w-full justify-start p-2",onClick:()=>{l({...e,category_id:e.category_id||e.id||""}),G(!0)},children:[(0,a.jsx)(I.Z,{className:"mr-2 h-4 w-4"}),"Add Subcategory"]})]})]},e.category_id||e.id||""))})]})}),(0,a.jsx)(f.Zb,{className:"col-span-9",children:(0,a.jsx)(f.aY,{className:"p-6",children:s?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:s.name}),(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsxs)(n.z,{variant:"outline",onClick:()=>ex(s),children:[(0,a.jsx)(S.Z,{className:"mr-2 h-4 w-4"}),"Edit Subcategory"]})})]},"subcategory-header"),(0,a.jsx)(w.Z,{},"subcategory-separator"),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Prompts"}),Object.entries(s.prompts).map(e=>{let[t,r]=e;return(0,a.jsx)(f.Zb,{className:"overflow-hidden",children:(0,a.jsxs)(f.aY,{className:"p-0",children:[(0,a.jsx)("div",{className:"bg-muted p-3 font-medium border-b",children:t}),(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)(V,{source:r})})]})},t)})]},"prompts-section")]}):r?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:r.name}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(n.z,{variant:"outline",onClick:e=>{e.stopPropagation(),console.log("Edit button clicked",r),r?ef(r):console.error("No category selected for editing")},children:[(0,a.jsx)(S.Z,{className:"mr-2 h-4 w-4"}),"Edit Category"]}),(0,a.jsxs)(n.z,{onClick:()=>{r&&l({...r,category_id:r.category_id||r.id||""}),G(!0)},children:[(0,a.jsx)(I.Z,{className:"mr-2 h-4 w-4"}),"Add Subcategory"]})]})]},"category-header"),(0,a.jsx)(w.Z,{},"category-separator"),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Subcategories"}),t.filter(e=>e.category_id===(r.category_id||r.id||"")).map(e=>(0,a.jsx)(n.z,{variant:"outline",className:"w-full justify-start text-left h-auto py-3",onClick:()=>eu(e),children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:[Object.keys(e.prompts).length," prompts"]})]})},e.id)),0===t.filter(e=>e.category_id===(r.category_id||r.id||"")).length&&(0,a.jsxs)(z,{children:[(0,a.jsx)(D,{children:"No subcategories"}),(0,a.jsx)(O,{children:'This category doesn\'t have any subcategories yet. Click the "Add Subcategory" button to create one.'})]},"no-subcategories-alert")]},"subcategories-section")]}):(0,a.jsxs)(z,{children:[(0,a.jsx)(D,{children:"No Selection"}),(0,a.jsx)(O,{children:"Please select a category or subcategory from the sidebar to view details."})]})})}),(0,a.jsx)(g.Vq,{open:B,onOpenChange:e=>{console.log("Add subcategory dialog change:",e),e||G(!1)},children:(0,a.jsxs)(g.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(g.fK,{children:(0,a.jsx)(g.$N,{children:"Add New Subcategory"})}),B&&(0,a.jsx)(H,{categories:e,selectedCategoryId:(null==r?void 0:r.category_id)||(null==r?void 0:r.id)||"",onSubmit:eg,onCancel:()=>G(!1)},"subcategory-form-".concat((null==r?void 0:r.category_id)||(null==r?void 0:r.id)||""))]})}),(0,a.jsx)(g.Vq,{open:q,onOpenChange:e=>{if(console.log("Edit category dialog state changing to:",e,"current state:",q),console.log("Selected category at dialog state change:",r),e){if(!r||!r.category_id&&!r.id)return console.error("Trying to open category dialog but no valid category is selected:",r),!1;K(!0),console.log("Dialog opened by onOpenChange with category ID:",r.category_id||r.id)}else K(!1),console.log("Dialog closed by onOpenChange")},children:(0,a.jsxs)(g.cZ,{children:[(0,a.jsx)(g.fK,{children:(0,a.jsx)(g.$N,{children:"Edit Category"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"edit-category-name",children:"Category Name"}),(0,a.jsx)(h.I,{id:"edit-category-name",value:M,onChange:e=>Y(e.target.value)})]},"category-name-field"),r&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Category ID: ",r.category_id||r.id]},"category-id-display"),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(n.z,{variant:"outline",onClick:()=>K(!1),children:"Cancel"}),(0,a.jsx)(n.z,{onClick:eh,disabled:i,children:i?"Saving...":"Save Changes"})]},"action-buttons")]})]})}),(0,a.jsx)(g.Vq,{open:$,onOpenChange:J,children:(0,a.jsxs)(g.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)(g.fK,{children:(0,a.jsx)(g.$N,{children:"Edit Subcategory"})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m._,{htmlFor:"edit-subcategory-name",children:"Subcategory Name"}),(0,a.jsx)(h.I,{id:"edit-subcategory-name",value:Q,onChange:e=>L(e.target.value)})]},"subcategory-name-field"),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m._,{children:"Prompts"}),(0,a.jsx)(R,{initialPrompts:W,onSave:X,onCancel:()=>J(!1),hideActionButtons:!0})]},"prompts-editor"),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)(n.z,{variant:"outline",onClick:()=>J(!1),children:"Cancel"}),(0,a.jsx)(n.z,{onClick:e=>{e.preventDefault(),em()},disabled:i,children:i?"Saving...":"Save Changes"})]},"action-buttons")]})]})}),(0,a.jsx)(g.Vq,{open:et,onOpenChange:er,children:(0,a.jsxs)(g.cZ,{children:[(0,a.jsxs)(g.fK,{children:[(0,a.jsxs)(g.$N,{className:"flex items-center gap-2",children:[(0,a.jsx)(_.Z,{className:"h-5 w-5 text-destructive"}),"Delete Category"]}),(0,a.jsxs)(g.Be,{children:['Are you sure you want to delete the category "',null==en?void 0:en.name,'"? This will also delete all subcategories and their prompts. This action cannot be undone.']})]}),(0,a.jsxs)(g.cN,{className:"gap-2 sm:gap-0",children:[(0,a.jsx)(n.z,{variant:"outline",onClick:()=>{er(!1),es(null)},children:"Cancel"}),(0,a.jsx)(n.z,{variant:"destructive",onClick:ey,disabled:i,children:i?"Deleting...":"Delete Category"})]})]})}),(0,a.jsx)(g.Vq,{open:ea,onOpenChange:eo,children:(0,a.jsxs)(g.cZ,{children:[(0,a.jsxs)(g.fK,{children:[(0,a.jsxs)(g.$N,{className:"flex items-center gap-2",children:[(0,a.jsx)(_.Z,{className:"h-5 w-5 text-destructive"}),"Delete Subcategory"]}),(0,a.jsxs)(g.Be,{children:['Are you sure you want to delete the subcategory "',null==ei?void 0:ei.name,'"? This will also delete all prompts associated with this subcategory. This action cannot be undone.']})]}),(0,a.jsxs)(g.cN,{className:"gap-2 sm:gap-0",children:[(0,a.jsx)(n.z,{variant:"outline",onClick:()=>{eo(!1),ec(null)},children:"Cancel"}),(0,a.jsx)(n.z,{variant:"destructive",onClick:ep,disabled:i,children:i?"Deleting...":"Delete Subcategory"})]})]})})]})}function K(){return(0,a.jsx)(d,{children:(0,a.jsxs)("div",{className:"flex-1 space-y-4 p-4 md:p-8 pt-6",children:[(0,a.jsx)(p,{}),(0,a.jsx)(q,{})]})})}},2339:function(e,t,r){"use strict";r.d(t,{SP:function(){return l},dr:function(){return c},mQ:function(){return i},nU:function(){return d}});var a=r(7437),o=r(2265),n=r(271),s=r(4508);let i=n.fC,c=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(n.aV,{ref:t,className:(0,s.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...o})});c.displayName=n.aV.displayName;let l=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(n.xz,{ref:t,className:(0,s.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...o})});l.displayName=n.xz.displayName;let d=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(n.VY,{ref:t,className:(0,s.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...o})});d.displayName=n.VY.displayName},7992:function(e,t,r){"use strict";r.d(t,{p:function(){return o}});var a=r(2265);function o(){let[e,t]=(0,a.useState)([]);return{toasts:e,toast:e=>{t(t=>[...t,{id:Date.now(),...e}])},dismiss:e=>{t(t=>t.filter(t=>t.id!==e))}}}},9116:function(e,t,r){"use strict";r.d(t,{A4:function(){return m},Ox:function(){return i},Wc:function(){return g},a$:function(){return o},cT:function(){return s},hv:function(){return h},k4:function(){return c},nv:function(){return y},pE:function(){return l},pH:function(){return n},uu:function(){return u},yr:function(){return d}});var a=r(9053);async function o(e,t){let r=await fetch(a.Ui,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));return await r.json()}async function n(e,t){let r=await fetch(a.C2,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),o=await r.json();return r.ok?o:{status:r.status,message:o.message||"An error occurred during login",access_token:"",token_type:""}}async function s(e,t,r,o){let n=new FormData;n.append("file",e),n.append("prompt_category_id",t),n.append("prompt_subcategory_id",r);let s=await fetch(a.C8,{method:"POST",headers:{Authorization:"Bearer ".concat(o)},body:n}),i=await s.json();if(!s.ok)throw Error(i.message||"HTTP error! status: ".concat(s.status));return i}async function i(){let e=localStorage.getItem("token");if(!e)throw Error("No authentication token found. Please log in again.");let t=await fetch(a.cn,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}async function c(e){let t=localStorage.getItem("token");if(!t)throw Error("No authentication token found. Please log in again.");let r=await fetch(a.rp,{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));return await r.json()}async function l(){let e=localStorage.getItem("token");if(!e)throw Error("No authentication token found. Please log in again.");let t=await fetch(a.rp,{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}async function d(e,t){if(!e)throw console.error("Category ID is undefined or empty"),Error("Invalid category ID. Cannot update category.");let r=localStorage.getItem("token");if(!r)throw Error("No authentication token found. Please log in again.");console.log("Updating category with ID:",e),console.log("New name:",t),console.log("Using token:",r.substring(0,15)+"...");try{let o=await fetch("".concat(a.rp,"/").concat(e),{method:"PUT",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify({name:t})});if(console.log("Update category response status:",o.status),!o.ok){if(401===o.status)throw console.error("Authentication failed (401). Token may be invalid or expired."),localStorage.removeItem("token"),Error("Authentication failed. Please log in again.");let e=await o.text();throw console.error("Error response body:",e),Error("HTTP error! status: ".concat(o.status,", message: ").concat(e))}return await o.json()}catch(e){throw console.error("Error updating category:",e),e}}async function u(e){let t=localStorage.getItem("token");if(!t)throw Error("No authentication token found. Please log in again.");let r=await fetch("".concat(a.rp,"/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status))}async function g(e,t,r){let o=localStorage.getItem("token");if(!o)throw Error("No authentication token found. Please log in again.");let n=await fetch(a.Gg,{method:"POST",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({name:e,category_id:t,prompts:r})});if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));return await n.json()}async function h(e){let t=localStorage.getItem("token");if(!t)throw Error("No authentication token found. Please log in again.");let r=e?"".concat(a.Gg,"?category_id=").concat(e):a.Gg,o=await fetch(r,{method:"GET",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(!o.ok)throw Error("HTTP error! status: ".concat(o.status));return await o.json()}async function m(e,t,r){let o=localStorage.getItem("token");if(!o)throw Error("No authentication token found. Please log in again.");if(!e)throw console.error("Subcategory ID is undefined or empty"),Error("Invalid subcategory ID. Cannot update subcategory.");console.log("Updating subcategory with ID:",e),console.log("New name:",t),console.log("New prompts:",r),console.log("Using token:",o.substring(0,15)+"...");try{let n=await fetch("".concat(a.Gg,"/").concat(e),{method:"PUT",headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json"},body:JSON.stringify({name:t,prompts:r})});if(console.log("Update subcategory response status:",n.status),!n.ok){if(401===n.status)throw console.error("Authentication failed (401). Token may be invalid or expired."),localStorage.removeItem("token"),Error("Authentication failed. Please log in again.");if(404===n.status)throw console.error("Subcategory not found (404)."),Error("Subcategory not found. It may have been already deleted.");let e=await n.text();throw console.error("Error response body:",e),Error("HTTP error! status: ".concat(n.status,", message: ").concat(e))}let s=await n.json();return console.log("Update subcategory response:",s),s}catch(e){throw console.error("Error updating subcategory:",e),e}}async function y(e){let t=localStorage.getItem("token");if(!t)throw Error("No authentication token found. Please log in again.");if(!e||"string"!=typeof e)throw console.error("Invalid subcategory ID:",e),Error("Invalid subcategory ID. Cannot delete subcategory.");console.log("Deleting subcategory with ID:",e),console.log("Using token:",t.substring(0,15)+"...");try{let r=await fetch("".concat(a.Gg,"/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(console.log("Delete subcategory response status:",r.status),!r.ok){if(401===r.status)throw console.error("Authentication failed (401). Token may be invalid or expired."),localStorage.removeItem("token"),Error("Authentication failed. Please log in again.");if(404===r.status)throw console.error("Subcategory not found (404)."),Error("Subcategory not found. It may have been already deleted.");let e=await r.text();throw console.error("Error response body:",e),Error("HTTP error! status: ".concat(r.status,", message: ").concat(e))}}catch(e){throw console.error("Error deleting subcategory:",e),e}}}},function(e){e.O(0,[135,38,787,21,542,421,158,971,117,744],function(){return e(e.s=5965)}),_N_E=e.O()}]);